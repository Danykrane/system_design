Discord‑подобные голос/видео‑звонки (WebRTC + SFU)

**Что просил преподаватель:** указать **размер аудитории** и **функционал**.  
Ниже — коротко и по делу (как входные данные для следующих разделов: нагрузка/ДЦ/балансировка).

---

## 1) Размер аудитории (гипотеза для расчётов)

Я ориентируюсь на Discord как на “реальный” аналог по продукту. У Discord публично фигурирует порядок **200M+ MAU**.

Чтобы не брать сразу “максимум”, но всё равно получить highload‑сценарий, для учебных расчётов фиксирую:

- **MAU:** 50 млн / месяц (глобально)
- **DAU:** 10 млн / день (глобально)

География (нужно будет дальше для выбора ДЦ и глобальной балансировки):
- Северная Америка + Европа — основной рынок (условно 70–80% трафика),
- остальные регионы — остальное.

> Почему так: мне важно, чтобы числа были достаточно большими, чтобы появились реальные ограничения (сеть/latency/фейловер), а не “всё помещается на одном сервере”.  
> Если на защите скажут “давай ближе к оригиналу” — метрики просто масштабируются линейно.

---

## 2) Функционал MVP (что я реально проектирую)

Фокус — **ядро голос/видео**, без записи и без “медиасервиса хранения”.

### 2.1 Что входит в MVP (7 функций)

1) **Логин + сессии устройств** (access/refresh, авторизация на WS).
2) **Join voice channel**: выбрать регион/endpoint, получить параметры для ICE (STUN/TURN), токен сессии.
3) **Сигналинг** (WebSocket): обмен SDP/ICE + события комнаты (join/leave, speaking).
4) **Голос через SFU** (Opus): клиент отправляет один поток на сервер, сервер раздаёт остальным участникам.
5) **Видео в комнате**: включить/выключить камеру, получать несколько активных видео (с ограничением, чтобы не “залить” канал).
6) **Screen share (упрощённо)**: один стример → много зрителей внутри комнаты.
7) **Надёжность**: reconnect при обрыве + переключение на другой voice‑сервер при сбое (минимальный failover‑сценарий).

### 2.2 Что сознательно не включаю в MVP
- запись звонков/стримов и хранение медиа
- “улучшайзеры” звука (AI‑шумодав и т.п.)
- монетизация/платежи, SDK/боты, discovery‑каталог серверов

---

## 3) Пару слов “почему SFU”
В многопользовательских комнатах P2P‑mesh быстро становится невыгодным: клиенту пришлось бы отправлять N копий потока всем участникам, упираемся в аплинк/энергию/мобильные сети.  
SFU решает это проще: **один исходящий поток на сервер**, а сервер уже делает ретрансляцию.

---

## Источники
1. Discord company page (публичные цифры по аудитории): https://discord.com/company  
2. Discord engineering blog про voice/WebRTC и масштабирование (почему SFU и как это живёт на больших нагрузках):  
   https://discord.com/blog/how-discord-handles-two-and-half-million-concurrent-voice-users-using-webrtc  
3. W3C WebRTC spec (термины и модель WebRTC): https://www.w3.org/TR/webrtc/  
